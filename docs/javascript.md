# Замыкание

Чтобы понять, что такое замыкание, необходимо сначала ознакомиться с понятием **лексического окружения**.

## Лексическое окружение

**Лексическое окружение** — это невидимый (скрытый) объект, присутствующий у любого блока, скрипта или функции в JavaScript. Оно состоит из двух частей:

1. **Объект переменных:**  
   Содержит все переменные, определённые в текущей области видимости.
2. **Ссылка на родительское окружение:**  
   Позволяет функции обращаться к переменным внешней (родительской) области видимости.
   
<div align="center">
  
  <img width="400" alt="Лексическое окружение" src="https://github.com/user-attachments/assets/99f1a6c0-096e-4700-9110-6a59382b8888" />

</div>

---

## Примеры

Ниже приведены примеры, демонстрирующие работу замыкания и лексического окружения.

### Пример 1: Простая функция с замыканием

```javascript
const x = 1;
const logToConsole = function () {
  const i = 'Hi';
  console.log(i);
};

logToConsole();
```

#### Объяснение примера 1

- **Глобальное окружение:**  
  Содержит переменные `x` и `logToConsole`, а также ссылку на родительское окружение (в данном случае — `null`).

- **Локальное окружение (внутри функции `logToConsole`):**  
  Создаётся при вызове функции и содержит переменную `i` со значением `"Hi"`. Это окружение имеет ссылку на глобальное окружение, что позволяет получить доступ к его переменным.

<div align="center">

  <img src="https://github.com/user-attachments/assets/99f1a6c0-096e-4700-9110-6a59382b8888" alt="Лексическое окружение" width="400px" />

</div>

> **Важно!**  
> Локальное лексическое окружение создаётся **только при вызове функции**.

---

## Порядок выполнения кода

1. **Создание глобального окружения:**  
   Изначально создаётся пустое глобальное лексическое окружение.
2. **Инициализация переменной `x`:**  
   В глобальное окружение добавляется переменная `x` со значением `1`.
3. **Определение функции `logToConsole`:**  
   Функция сохраняется в глобальном окружении.
4. **Вызов функции `logToConsole`:**  
   При вызове создаётся новое локальное лексическое окружение.
5. **Инициализация переменной `i`:**  
   В локальном окружении добавляется переменная `i` со значением `"Hi"`.
6. **Вывод в консоль:**  
   Значение переменной `i` выводится в консоль.
7. **Завершение работы функции:**  
   Локальное окружение уничтожается, и управление возвращается в глобальное окружение.
8. **Завершение выполнения скрипта.**

---

## Визуальное представление

Вот как выглядит процесс создания и работы лексических окружений:

<div align="center">

<img src="https://github.com/user-attachments/assets/ff1b03d1-2da7-4df7-93d6-4196c127e972" alt="Визуальное представление" width="400px" />

</div>

---

## Замыкание

Теперь перейдём к самому понятию **замыкания**.

### Определение

**Замыкание** — это способность функции в JavaScript **запоминать** лексическое окружение, в котором она была создана, и обращаться к нему даже после завершения работы внешней функции.

---

### Пример 2: Функция с замыканием

Рассмотрим изменённый вариант предыдущего примера, который демонстрирует работу замыкания. Теперь мы выведем в консоль переменную `x`, которая была объявлена вне функции:

```javascript
const x = 1;
const logToConsole = function () {
  console.log(x);
};

logToConsole(); // 1
```

---

### Разбор кода

1. **Создаётся глобальное лексическое окружение.**
2. **В глобальном окружении создаётся переменная `x` со значением `1`.**
3. **Определяется функция `logToConsole`.**
4. **При вызове `logToConsole` создаётся новое локальное лексическое окружение.**
5. **Происходит выполнение `console.log(x)`.**
6. **Так как в локальном окружении нет переменной `x`, интерпретатор ищет её во внешнем окружении (глобальном).**
7. **Находит `x = 1` и выводит его в консоль.**
8. **Функция завершает выполнение, локальное окружение уничтожается.**

Таким образом, функция **помнит** окружение, в котором была создана, и может в любой момент к нему обратиться. Это и есть **замыкание**.

---

## Визуальное представление

Вот как выглядит процесс создания и работы лексических окружений с замыканием:

<div align="center">
   
<img src="https://github.com/user-attachments/assets/f0c40793-e4e5-4e45-8c98-91f418cc5595" alt="Визуальное представление" width="400px" />

</div>
